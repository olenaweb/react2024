// DetailPage.tsx
import { useState, useEffect } from 'react';
import { useParams } from 'react-router-dom';
import { useGetCharacterByIdQuery } from '../store/services/characterApi';
import Loader from '../components/Loader';
import ErrorPage from './ErrorPage';

const DetailPage = () => {
  const { id } = useParams<{ id: string }>();
  const [trigger, setTrigger] = useState(false);

  // Introduce delay before setting trigger to true
  useEffect(() => {
    const timer = setTimeout(() => {
      setTrigger(true);
    }, 3000); // 300ms delay

    return () => clearTimeout(timer);
  }, []);

  const { data, error, isLoading } = useGetCharacterByIdQuery(id!, {
    skip: !trigger,
  });

  if (isLoading) {
    return <Loader />;
  }

  if (error) {
    return <ErrorPage />;
  }

  return (
    <div>
      <h1>{data?.name}</h1>
      <p>Status: {data?.status}</p>
      <p>Species: {data?.species}</p>
      <p>Gender: {data?.gender}</p>
      <img src={data?.image} alt={data?.name} />
    </div>
  );
};

export default DetailPage;
